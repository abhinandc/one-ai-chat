-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.activity_events (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_email text NOT NULL,
  action text NOT NULL,
  resource_type text NOT NULL,
  resource_id text NOT NULL,
  metadata jsonb DEFAULT '{}'::jsonb,
  timestamp timestamp with time zone DEFAULT now(),
  CONSTRAINT activity_events_pkey PRIMARY KEY (id)
);
CREATE TABLE public.admin_settings (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  section character varying NOT NULL,
  key character varying NOT NULL,
  value_json jsonb NOT NULL DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT admin_settings_pkey PRIMARY KEY (id)
);
CREATE TABLE public.admin_users (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  email text NOT NULL UNIQUE,
  name text NOT NULL,
  role text DEFAULT 'viewer'::text CHECK (role = ANY (ARRAY['super_admin'::text, 'admin'::text, 'editor'::text, 'viewer'::text])),
  tenant text,
  is_vip boolean DEFAULT false,
  status text DEFAULT 'pending'::text CHECK (status = ANY (ARRAY['active'::text, 'inactive'::text, 'pending'::text])),
  last_login timestamp with time zone,
  permissions ARRAY DEFAULT '{}'::text[],
  mfa_enabled boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT admin_users_pkey PRIMARY KEY (id)
);
CREATE TABLE public.agent_workflows (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_email text NOT NULL,
  agent_id text NOT NULL,
  name text NOT NULL,
  description text,
  workflow_data jsonb NOT NULL DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT agent_workflows_pkey PRIMARY KEY (id)
);
CREATE TABLE public.aliases (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  alias character varying NOT NULL UNIQUE,
  model_names_json jsonb NOT NULL DEFAULT '[]'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT aliases_pkey PRIMARY KEY (id)
);
CREATE TABLE public.api_usage_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_email text NOT NULL,
  model text NOT NULL,
  tokens_used integer NOT NULL DEFAULT 0,
  cost_usd numeric DEFAULT 0.0,
  request_type text DEFAULT 'completion'::text,
  metadata jsonb DEFAULT '{}'::jsonb,
  timestamp timestamp with time zone DEFAULT now(),
  CONSTRAINT api_usage_logs_pkey PRIMARY KEY (id)
);
CREATE TABLE public.automation_executions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  automation_id uuid,
  user_email text NOT NULL,
  status text DEFAULT 'running'::text,
  started_at timestamp with time zone DEFAULT now(),
  completed_at timestamp with time zone,
  input_data jsonb,
  output_data jsonb,
  error_message text,
  CONSTRAINT automation_executions_pkey PRIMARY KEY (id),
  CONSTRAINT automation_executions_automation_id_fkey FOREIGN KEY (automation_id) REFERENCES public.automations(id)
);
CREATE TABLE public.automations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_email text NOT NULL,
  name text NOT NULL,
  description text,
  agent_id text NOT NULL,
  enabled boolean DEFAULT true,
  total_runs integer DEFAULT 0,
  success_rate numeric DEFAULT 100.0,
  last_run_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT automations_pkey PRIMARY KEY (id)
);
CREATE TABLE public.chat_conversations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_email text NOT NULL,
  title text NOT NULL,
  settings jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT chat_conversations_pkey PRIMARY KEY (id)
);
CREATE TABLE public.chat_messages (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  conversation_id uuid,
  user_email text NOT NULL,
  role text NOT NULL,
  content text NOT NULL,
  metadata_json jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT chat_messages_pkey PRIMARY KEY (id),
  CONSTRAINT chat_messages_conversation_id_fkey FOREIGN KEY (conversation_id) REFERENCES public.chat_conversations(id)
);
CREATE TABLE public.conversation_folders (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_email text NOT NULL,
  name text NOT NULL,
  color text NOT NULL DEFAULT 'bg-accent-blue'::text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT conversation_folders_pkey PRIMARY KEY (id)
);
CREATE TABLE public.conversations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_email text NOT NULL,
  title text NOT NULL,
  messages jsonb NOT NULL DEFAULT '[]'::jsonb,
  folder_id uuid,
  pinned boolean DEFAULT false,
  shared boolean DEFAULT false,
  unread boolean DEFAULT false,
  tags ARRAY DEFAULT '{}'::text[],
  settings jsonb NOT NULL DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT conversations_pkey PRIMARY KEY (id),
  CONSTRAINT conversations_folder_id_fkey FOREIGN KEY (folder_id) REFERENCES public.conversation_folders(id)
);
CREATE TABLE public.email_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  to_email character varying NOT NULL,
  subject character varying NOT NULL,
  template character varying NOT NULL,
  status character varying NOT NULL,
  data jsonb,
  sent_at timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT email_logs_pkey PRIMARY KEY (id)
);
CREATE TABLE public.guardrails (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name character varying NOT NULL,
  config_json jsonb NOT NULL DEFAULT '{}'::jsonb,
  enabled boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  team_id uuid,
  created_by uuid,
  priority integer DEFAULT 100,
  type text DEFAULT 'both'::text CHECK (type = ANY (ARRAY['pre'::text, 'post'::text, 'both'::text])),
  description text,
  rules_json jsonb DEFAULT '[]'::jsonb,
  metadata_json jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT guardrails_pkey PRIMARY KEY (id),
  CONSTRAINT guardrails_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.guardrails_library (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL UNIQUE,
  category text NOT NULL,
  description text,
  provider text,
  type text NOT NULL DEFAULT 'both'::text,
  config_template jsonb DEFAULT '{}'::jsonb,
  severity text DEFAULT 'medium'::text,
  default_action text DEFAULT 'warn'::text,
  tags ARRAY DEFAULT '{}'::text[],
  is_enterprise boolean DEFAULT false,
  is_builtin boolean DEFAULT true,
  documentation_url text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT guardrails_library_pkey PRIMARY KEY (id)
);
CREATE TABLE public.ip_allowlist (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  ip_address inet NOT NULL,
  cidr text,
  description text,
  enabled boolean DEFAULT true,
  created_by text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT ip_allowlist_pkey PRIMARY KEY (id)
);
CREATE TABLE public.key_budget_allocations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  key_id uuid,
  email text,
  daily_budget_usd numeric DEFAULT 10.00,
  weekly_budget_usd numeric DEFAULT 50.00,
  monthly_budget_usd numeric DEFAULT 200.00,
  daily_token_limit integer DEFAULT 100000,
  weekly_token_limit integer DEFAULT 500000,
  monthly_token_limit integer DEFAULT 2000000,
  allowed_hours_start integer DEFAULT 0,
  allowed_hours_end integer DEFAULT 24,
  allowed_days ARRAY DEFAULT ARRAY['monday'::text, 'tuesday'::text, 'wednesday'::text, 'thursday'::text, 'friday'::text, 'saturday'::text, 'sunday'::text],
  soft_cap_percentage integer DEFAULT 80,
  hard_cap_enabled boolean DEFAULT true,
  current_daily_spend numeric DEFAULT 0,
  current_weekly_spend numeric DEFAULT 0,
  current_monthly_spend numeric DEFAULT 0,
  current_daily_tokens integer DEFAULT 0,
  current_weekly_tokens integer DEFAULT 0,
  current_monthly_tokens integer DEFAULT 0,
  last_reset_daily timestamp with time zone,
  last_reset_weekly timestamp with time zone,
  last_reset_monthly timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT key_budget_allocations_pkey PRIMARY KEY (id),
  CONSTRAINT key_budget_allocations_key_id_fkey FOREIGN KEY (key_id) REFERENCES public.virtual_keys(id)
);
CREATE TABLE public.llm_credentials (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  provider text NOT NULL,
  name text NOT NULL,
  api_key_encrypted text,
  org_id text,
  project_id text,
  region text,
  endpoint_url text,
  is_default boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by text DEFAULT 'system'::text,
  team_id text,
  CONSTRAINT llm_credentials_pkey PRIMARY KEY (id)
);
CREATE TABLE public.logs (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  ts timestamp with time zone DEFAULT now(),
  app character varying NOT NULL,
  level USER-DEFINED NOT NULL,
  message text NOT NULL,
  json_payload jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT logs_pkey PRIMARY KEY (id)
);
CREATE TABLE public.mcp_server_tools (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  server_id uuid,
  tool_name text NOT NULL,
  description text,
  input_schema jsonb DEFAULT '{}'::jsonb,
  enabled boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT mcp_server_tools_pkey PRIMARY KEY (id),
  CONSTRAINT mcp_server_tools_server_id_fkey FOREIGN KEY (server_id) REFERENCES public.mcp_servers(id)
);
CREATE TABLE public.mcp_servers (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name character varying NOT NULL UNIQUE,
  base_url text NOT NULL,
  api_key character varying,
  assigned_models_json jsonb DEFAULT '[]'::jsonb,
  enabled boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  alias text,
  transport text DEFAULT 'http'::text,
  auth_type text DEFAULT 'none'::text,
  access_groups ARRAY DEFAULT ARRAY['all'::text],
  health_status text DEFAULT 'checking'::text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_by text DEFAULT 'system'::text,
  CONSTRAINT mcp_servers_pkey PRIMARY KEY (id)
);
CREATE TABLE public.mcp_user_assignments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  server_id uuid,
  user_email text NOT NULL,
  tools_allowed ARRAY DEFAULT '{}'::text[],
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT mcp_user_assignments_pkey PRIMARY KEY (id),
  CONSTRAINT mcp_user_assignments_server_id_fkey FOREIGN KEY (server_id) REFERENCES public.mcp_servers(id)
);
CREATE TABLE public.model_admin_settings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  model_id uuid,
  model_name text NOT NULL UNIQUE,
  system_prompt text,
  default_temperature numeric DEFAULT 0.7,
  default_top_p numeric DEFAULT 1.0,
  default_top_k integer DEFAULT 40,
  default_max_tokens integer DEFAULT 4096,
  default_frequency_penalty numeric DEFAULT 0,
  default_presence_penalty numeric DEFAULT 0,
  guardrail_ids ARRAY DEFAULT '{}'::uuid[],
  allow_temperature_override boolean DEFAULT true,
  allow_top_p_override boolean DEFAULT true,
  allow_top_k_override boolean DEFAULT true,
  allow_max_tokens_override boolean DEFAULT true,
  allow_system_prompt_addition boolean DEFAULT false,
  min_temperature numeric DEFAULT 0,
  max_temperature numeric DEFAULT 2.0,
  min_top_p numeric DEFAULT 0,
  max_top_p numeric DEFAULT 1.0,
  min_max_tokens integer DEFAULT 1,
  max_max_tokens integer DEFAULT 32000,
  enabled boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT model_admin_settings_pkey PRIMARY KEY (id),
  CONSTRAINT model_admin_settings_model_id_fkey FOREIGN KEY (model_id) REFERENCES public.models(id)
);
CREATE TABLE public.model_aliases (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  alias text NOT NULL UNIQUE,
  model_names_json jsonb DEFAULT '[]'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  description text,
  priority integer DEFAULT 0,
  CONSTRAINT model_aliases_pkey PRIMARY KEY (id)
);
CREATE TABLE public.model_analytics (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  model_id uuid,
  model_name text NOT NULL,
  total_requests integer DEFAULT 0,
  successful_requests integer DEFAULT 0,
  failed_requests integer DEFAULT 0,
  avg_latency_ms integer DEFAULT 0,
  total_tokens integer DEFAULT 0,
  total_cost numeric DEFAULT 0,
  error_rate numeric DEFAULT 0,
  date date DEFAULT CURRENT_DATE,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT model_analytics_pkey PRIMARY KEY (id)
);
CREATE TABLE public.model_health_checks (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  model_id uuid,
  model_name text,
  status text CHECK (status = ANY (ARRAY['online'::text, 'offline'::text, 'degraded'::text, 'checking'::text])),
  response_time_ms integer,
  error_message text,
  checked_at timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT model_health_checks_pkey PRIMARY KEY (id)
);
CREATE TABLE public.model_health_status (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  model_id uuid,
  model_name text NOT NULL,
  endpoint text,
  status text DEFAULT 'checking'::text CHECK (status = ANY (ARRAY['online'::text, 'offline'::text, 'degraded'::text, 'checking'::text])),
  response_time_ms integer,
  last_checked timestamp with time zone DEFAULT now(),
  error_message text,
  uptime_percentage numeric,
  CONSTRAINT model_health_status_pkey PRIMARY KEY (id)
);
CREATE TABLE public.model_pricing_data (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  model_id uuid,
  model_name text NOT NULL,
  provider text NOT NULL,
  input_price_per_1k numeric DEFAULT 0,
  output_price_per_1k numeric DEFAULT 0,
  cached_input_price_per_1k numeric,
  image_price_per_unit numeric,
  audio_price_per_minute numeric,
  last_updated timestamp with time zone DEFAULT now(),
  currency text DEFAULT 'USD'::text,
  CONSTRAINT model_pricing_data_pkey PRIMARY KEY (id)
);
CREATE TABLE public.model_retry_settings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  model_id uuid,
  max_retries integer DEFAULT 3,
  initial_delay_ms integer DEFAULT 1000,
  max_delay_ms integer DEFAULT 30000,
  backoff_multiplier numeric DEFAULT 2.0,
  retry_on_timeout boolean DEFAULT true,
  retry_on_rate_limit boolean DEFAULT true,
  retry_on_server_error boolean DEFAULT true,
  custom_retry_codes ARRAY DEFAULT '{}'::integer[],
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT model_retry_settings_pkey PRIMARY KEY (id)
);
CREATE TABLE public.models (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  provider text NOT NULL DEFAULT 'Unknown'::text,
  kind text DEFAULT 'chat'::text,
  mode text DEFAULT 'chat'::text,
  max_tokens integer DEFAULT 4096,
  context_length integer DEFAULT 4096,
  cost_per_1k_input numeric DEFAULT 0,
  cost_per_1k_output numeric DEFAULT 0,
  features ARRAY DEFAULT '{}'::text[],
  is_public boolean DEFAULT false,
  is_available boolean DEFAULT true,
  description text,
  endpoint_url text,
  api_key_encrypted text,
  api_version text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  config jsonb DEFAULT '{}'::jsonb,
  display_name text,
  model_key text,
  CONSTRAINT models_pkey PRIMARY KEY (id)
);
CREATE TABLE public.pass_through_endpoints (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name character varying NOT NULL,
  url text NOT NULL,
  headers_json jsonb DEFAULT '{}'::jsonb,
  enabled boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  team_id uuid,
  created_by uuid,
  last_health_status text,
  last_health_checked_at timestamp with time zone,
  path text,
  target_url text,
  is_active boolean DEFAULT true,
  allowed_methods ARRAY DEFAULT ARRAY['GET'::text, 'POST'::text],
  auth_type text DEFAULT 'bearer'::text,
  rate_limit_rpm integer,
  strip_prefix boolean DEFAULT true,
  CONSTRAINT pass_through_endpoints_pkey PRIMARY KEY (id),
  CONSTRAINT pass_through_endpoints_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.playground_sessions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_email text NOT NULL,
  name text NOT NULL,
  model text NOT NULL,
  prompt text NOT NULL,
  response text,
  parameters jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT playground_sessions_pkey PRIMARY KEY (id)
);
CREATE TABLE public.prompt_interactions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  prompt_id uuid,
  user_email text NOT NULL,
  interaction_type text NOT NULL,
  timestamp timestamp with time zone DEFAULT now(),
  CONSTRAINT prompt_interactions_pkey PRIMARY KEY (id),
  CONSTRAINT prompt_interactions_prompt_id_fkey FOREIGN KEY (prompt_id) REFERENCES public.prompt_templates(id)
);
CREATE TABLE public.prompt_likes (
  user_email text NOT NULL,
  prompt_id uuid NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT prompt_likes_pkey PRIMARY KEY (user_email, prompt_id),
  CONSTRAINT prompt_likes_prompt_id_fkey FOREIGN KEY (prompt_id) REFERENCES public.prompt_templates(id)
);
CREATE TABLE public.prompt_templates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_email text NOT NULL,
  title text NOT NULL,
  description text,
  content text NOT NULL,
  category text DEFAULT 'General'::text,
  tags ARRAY DEFAULT '{}'::text[],
  is_public boolean DEFAULT false,
  likes_count integer DEFAULT 0,
  uses_count integer DEFAULT 0,
  difficulty text DEFAULT 'beginner'::text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT prompt_templates_pkey PRIMARY KEY (id)
);
CREATE TABLE public.provider_billing (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  provider text NOT NULL UNIQUE,
  current_month_spend numeric DEFAULT 0,
  previous_month_spend numeric DEFAULT 0,
  billing_cycle_start date,
  billing_cycle_end date,
  credit_balance numeric DEFAULT 0,
  payment_method text,
  last_invoice_amount numeric,
  last_invoice_date date,
  api_key_id text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT provider_billing_pkey PRIMARY KEY (id)
);
CREATE TABLE public.rippling_employees (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  rippling_id text NOT NULL UNIQUE,
  name text NOT NULL,
  email text NOT NULL,
  department text,
  title text,
  start_date text,
  status text NOT NULL DEFAULT 'active'::text,
  avatar_url text,
  synced_at timestamp with time zone NOT NULL DEFAULT now(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT rippling_employees_pkey PRIMARY KEY (id)
);
CREATE TABLE public.scim_config (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  enabled boolean DEFAULT false,
  endpoint_url text,
  bearer_token text,
  user_provisioning boolean DEFAULT true,
  group_provisioning boolean DEFAULT false,
  sync_interval integer DEFAULT 60,
  last_sync timestamp with time zone,
  sync_status text DEFAULT 'idle'::text CHECK (sync_status = ANY (ARRAY['idle'::text, 'syncing'::text, 'error'::text])),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT scim_config_pkey PRIMARY KEY (id)
);
CREATE TABLE public.scim_groups (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  external_id character varying NOT NULL UNIQUE,
  name character varying NOT NULL,
  members_json jsonb DEFAULT '[]'::jsonb,
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT scim_groups_pkey PRIMARY KEY (id)
);
CREATE TABLE public.scim_users (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  external_id character varying NOT NULL UNIQUE,
  email character varying NOT NULL,
  active boolean NOT NULL DEFAULT true,
  data_json jsonb DEFAULT '{}'::jsonb,
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT scim_users_pkey PRIMARY KEY (id)
);
CREATE TABLE public.security_settings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  mfa_required boolean DEFAULT false,
  session_timeout integer DEFAULT 60,
  password_policy jsonb DEFAULT '{"min_length": 8, "expiry_days": 90, "require_numbers": true, "require_lowercase": true, "require_uppercase": true, "require_special_chars": true}'::jsonb,
  ip_restriction_enabled boolean DEFAULT false,
  audit_logging_enabled boolean DEFAULT true,
  api_rate_limit integer DEFAULT 1000,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT security_settings_pkey PRIMARY KEY (id)
);
CREATE TABLE public.sso_configs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  provider text NOT NULL CHECK (provider = ANY (ARRAY['saml'::text, 'oauth'::text, 'oidc'::text, 'azure_ad'::text, 'google'::text, 'okta'::text])),
  name text NOT NULL,
  enabled boolean DEFAULT false,
  config jsonb DEFAULT '{}'::jsonb,
  domains ARRAY DEFAULT '{}'::text[],
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT sso_configs_pkey PRIMARY KEY (id)
);
CREATE TABLE public.team_invitations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  email character varying NOT NULL,
  role character varying NOT NULL,
  team_id text NOT NULL,
  invited_by character varying NOT NULL,
  status character varying NOT NULL DEFAULT 'pending'::character varying,
  token character varying NOT NULL UNIQUE,
  expires_at timestamp with time zone NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT team_invitations_pkey PRIMARY KEY (id),
  CONSTRAINT team_invitations_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id)
);
CREATE TABLE public.team_members (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  email character varying NOT NULL,
  name character varying,
  role character varying NOT NULL,
  status character varying NOT NULL DEFAULT 'active'::character varying,
  team_id text NOT NULL,
  invited_by character varying,
  invited_at timestamp with time zone DEFAULT now(),
  last_active timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT team_members_pkey PRIMARY KEY (id),
  CONSTRAINT team_members_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id)
);
CREATE TABLE public.teams (
  id text NOT NULL,
  name character varying NOT NULL,
  description text,
  owner_id character varying NOT NULL,
  settings jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT teams_pkey PRIMARY KEY (id)
);
CREATE TABLE public.tool_installations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_email text NOT NULL,
  tool_name text NOT NULL,
  agent_id text NOT NULL,
  configuration jsonb DEFAULT '{}'::jsonb,
  status text DEFAULT 'active'::text CHECK (status = ANY (ARRAY['active'::text, 'inactive'::text, 'error'::text])),
  installed_at timestamp with time zone DEFAULT now(),
  CONSTRAINT tool_installations_pkey PRIMARY KEY (id)
);
CREATE TABLE public.tool_submissions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_email text NOT NULL,
  name text NOT NULL,
  description text NOT NULL,
  category text NOT NULL,
  implementation text NOT NULL,
  status text DEFAULT 'pending'::text CHECK (status = ANY (ARRAY['pending'::text, 'approved'::text, 'rejected'::text])),
  submitted_at timestamp with time zone DEFAULT now(),
  CONSTRAINT tool_submissions_pkey PRIMARY KEY (id)
);
CREATE TABLE public.usage (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  ts timestamp with time zone DEFAULT now(),
  key_id uuid,
  email character varying NOT NULL,
  team_id uuid,
  model character varying NOT NULL,
  endpoint character varying NOT NULL,
  tokens_in integer NOT NULL DEFAULT 0,
  tokens_out integer NOT NULL DEFAULT 0,
  cost_usd numeric NOT NULL DEFAULT 0,
  latency_ms integer NOT NULL DEFAULT 0,
  status USER-DEFINED NOT NULL DEFAULT 'success'::usage_status,
  tag character varying,
  model_provider text,
  metadata jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT usage_pkey PRIMARY KEY (id),
  CONSTRAINT usage_key_id_fkey FOREIGN KEY (key_id) REFERENCES public.virtual_keys(id)
);
CREATE TABLE public.user_agent_activity (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  ts timestamp with time zone DEFAULT now(),
  email character varying NOT NULL,
  action character varying NOT NULL,
  meta_json jsonb DEFAULT '{}'::jsonb,
  team_id uuid,
  environment text,
  CONSTRAINT user_agent_activity_pkey PRIMARY KEY (id)
);
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  email character varying NOT NULL UNIQUE,
  name character varying NOT NULL,
  role USER-DEFINED NOT NULL DEFAULT 'user'::user_role,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT users_pkey PRIMARY KEY (id)
);
CREATE TABLE public.virtual_keys (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  key_hash character varying NOT NULL UNIQUE,
  label character varying NOT NULL,
  email character varying NOT NULL,
  team_id uuid,
  models_json jsonb NOT NULL DEFAULT '[]'::jsonb,
  budget_usd numeric NOT NULL DEFAULT 25.00,
  expires_at timestamp with time zone,
  rpm integer NOT NULL DEFAULT 120,
  rpd integer NOT NULL DEFAULT 2000,
  tpm integer NOT NULL DEFAULT 10000,
  tpd integer NOT NULL DEFAULT 100000,
  created_at timestamp with time zone DEFAULT now(),
  disabled boolean NOT NULL DEFAULT false,
  tags_json jsonb DEFAULT '[]'::jsonb,
  masked_key text,
  admin_virtual_key_id text,
  CONSTRAINT virtual_keys_pkey PRIMARY KEY (id)
);